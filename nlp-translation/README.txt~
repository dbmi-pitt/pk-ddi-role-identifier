NLP Translation CSV-XML

Richard Mau ALLTEMP, Richard Boyce PhD
April 8, 2015

DESCRIPTION:
Translate the all-consensus-interaction-entities-dumped-05162011.csv file
into an XML document for the gold standard and follow on use.

FILES:
	-nlpTranslation.xml
	-all-statements-combined' directory
	
	output: argv[1] # writes the argv[1] as the filename and over writes
			if it already exists. Need the .xml extension.
	input:  working directory contains the 'all-statements-combined' directory

USAGE: 
	Generate the XML document
	1. Ensure 'all-statements-combined' directory is in working directory
	2. Input into terminal: python nlpTranslation.py [output_filename].xml

VALIDATION:
	COMMANDS:
		-- Get the number of documents in nlpTranslation.xml
		grep -wc '<document' nlpTranslation.xml

		-- Get the number of documents in csv per document
		grep 'section-[0-9]*' all-consensus-interaction-entities-dumped-05162011.csv | cut -d, -f1| sort | uniq -c | wc -l

		-- Do the next commands in xmllint
		xmllint --shell task1-2.xml

			-- Get the number of interactions in the task1-2.xml
			xpath //document/sentencespan/pair[@interaction='true']

			-- Get the number of negative modalities
			xpath //document/sentencespan/pair[@modality='Negative']
	
			-- Get the number of positive modalities
			xpath //document/sentencespan/pair[@modality='Positive']

			-- to Add interactionPhraseType
			xpath //document/sentencespan/pair[@modality='Negative' and @interactionPhraseType='Qualitative']
			xpath //document/sentencespan/pair[@modality='Negative' and @interactionPhraseType='Quantitative']
	
			xpath //document/sentencespan/pair[@modality='Positive' and @interactionPhraseType='Qualitative']
			xpath //document/sentencespan/pair[@modality='Positive' and @interactionPhraseType='Quantitative']
	
	OUTPUT:
		Documentation:
		- interactions = 592
		- negative modality = 204
		- negative qualitative modality = 202 
		- negative quantitative modality = 2 
		- positive modality = 388
		- positive qualitative modality = 186
		- positive quantitative modality = 202
		XML:
		- interactions = 588
		- negative modality = 204 
		- negative qualitative modality = 197
		- negative quantitative modality = 7 
		- positive modality = 353
		- positive qualitative modality = 171
		- positive quantitative modality = 182
		The missing 31 modalities are derived from the package-insert-section-xxx.txt where sentence length is one and therefore is not accounted for in the 
		the sentencespan search. Below is a list of those files:
			100
			116
			124
			125
			126
			13
			130
			131
			133
			134
			151
			152
			159
			163
			164
			19
			191
			192
			199
			200
			203
			53
			54
			57
			77
			80
			84
			95
			96
			97
			99
NOTES:
The script does not use a learning mechanism to determine the drug interactions (i.e. interactions cross files). The script parses each package file and
only identifies drugs listed in the csv file and its interactions. For example in package-insert-section-123.txt, the annotated interactions take place
in offsets 9050-11699 so any drugs mentioned before that are not parsed. The script recognizes when a precipitant and object are BOTH mentioned in a 
sentence and parses it, however, if there is no mention of the BOTH precipitant and object then the sentence is not parsed. This creates gaps as the
script does not account for implied drugs in the context of the entire package file. In order to close this gap, the sentencespan element was added
to provide an adhoc solution by grouping sentences into three sentences. The script does not create a sentencespan if the sentence length is one. 

The validation shows that there are FOUR missing interactions (588/592) which puts the script at .9932. The four missing interactions are where
the sentencespans split. Currently those four missing interactions are unknown. 
		


